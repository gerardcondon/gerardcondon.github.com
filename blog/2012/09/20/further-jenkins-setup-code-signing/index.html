
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Further Jenkins Setup for iOS - Gerard Condon's Blog</title>
  <meta name="author" content="Gerard Condon">

  
  <meta name="description" content="Last time I went through how I set up jenkins on iOS and built a simple static library. All in all, that process went ok. The next step was to build &hellip;">
  <meta name="keywords" content="XCode 4.5, jenkins, iOS, build, app">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.gerardcondon.com/blog/2012/09/20/further-jenkins-setup-code-signing/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="feed://feeds.feedburner.com/GerardCondonsBlog" rel="alternate" title="Gerard Condon's Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-29293592-1']);
    _gaq.push(['_trackPageview']);
    setTimeout("_gaq.push(['_trackEvent', '15_seconds', 'read'])",15000);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Gerard Condon's Blog</a></h1>
  
    <h2>Journal of a software developer.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="feed://feeds.feedburner.com/GerardCondonsBlog" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.gerardcondon.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/projects">Projects</a></li>
  <li><a href="/about">About</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Further Jenkins Setup for iOS</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-09-20T01:15:00+01:00" pubdate data-updated="true">Sep 20<span>th</span>, 2012</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Last <a href="http://www.gerardcondon.com/blog/2012/09/16/setting-up-jenkins-on-os-x/">time</a> I went through how I set up jenkins on iOS and built a simple static library. All in all, that process went ok. The next step was to build an actual app. Unfortunately I encountered a lot more issues with this.</p>

<p>The first error I got was</p>

<pre><code>Code Sign error: The identity 'iPhone Developer' doesn't match any valid certificate/private key pair in the default keychain` 
</code></pre>

<p>This <a href="http://stackoverflow.com/questions/9245149/jenkins-on-os-x-xcodebuild-gives-code-sign-error/9246321#9246321">post</a> on Stack Overflow has a really detailed set of instructions on how best to fix this. Unfortunately as my iPhone developer account is not a business one, I can&#8217;t add a jenkins user to it. So to solve my problem I added my certificate to the system keychain so that now my local jenkins user can access it.</p>

<p>Once that was out of the way, the next issue to rear its head was a provisioning profile error.</p>

<pre><code>Code Sign error: A valid provisioning profile matching the application's Identifier '...' could not be found
</code></pre>

<p>I found the solution to this again on <a href="http://stackoverflow.com/questions/10454628/xcodebuild-code-sign-error-provisioning-profile-x-cant-be-found">Stack Overflow</a>.
I needed to copy my provisioning profile from <code>~/Library/MobileDevice/Provisioning</code> to the jenkins user&#8217;s folder at <code>/Users/Shared/Jenkins/Home/Library/MobileDevice/Provisioning Profiles</code>.</p>

<p>The next reason for the build failing was that I was invoking xcodebuild using a target instead of a scheme. The target worked fine for the static library but was failing for the app as it was unable to find all the include files. Once I switched to building a scheme, the build worked fine. Building via a scheme or target is easy to configure using the Jenkins XCode plugin. You set the XCode Schema File entry to the name of the XCode build scheme.</p>

<p>Nearly there! Now that the build was working I turned my attention to getting the unit tests running. The <code>TEST_AFTER_BUILD</code> flag that had worked before wasn&#8217;t working this time. Fortunately I found the solution on Peter Jihoon Kim&#8217;s <a href="http://www.raingrove.com/2012/03/28/running-ocunit-and-specta-tests-from-command-line.html">blog</a>. I needed to create a new scheme to run my tests. Once that was done I got this error</p>

<pre><code>/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/Tools/Tools/RunPlatformUnitTests:95: warning: Skipping tests; the iPhoneSimulator platform does not currently support application-hosted tests (TEST_HOST set).
</code></pre>

<p>Peter&#8217;s blog describes the fix for this. You need to patch the <code>RunPlatformUnitTests</code> file in order to remove the warning printout and invoke the tests.</p>

<p>The last error I had to deal with was with the code coverage. I started seeing errors with <code>fopen$UNIX2003</code> and <code>fwrite$UNIX2003</code>. I had seen this issue on other blogs before but hadn&#8217;t encountered it myself until I tried building an app using the command line. The solution as described <a href="http://stackoverflow.com/questions/8732393/code-coverage-with-xcode-4-2-missing-files">here</a> is to add implementations of these into your application which simply call the standard C functions.</p>

<pre><code>#include &lt;stdio.h&gt;

FILE *fopen$UNIX2003( const char *filename, const char *mode )
{
    return fopen(filename, mode);
}

size_t fwrite$UNIX2003( const void *a, size_t b, size_t c, FILE *d )
{
    return fwrite(a, b, c, d);
}
</code></pre>

<p>One unresolved issue was that I couldn&#8217;t get clang scan plugin working for this setup. I think the issue here is that it was using targets instead of schemes. I left this one go as I didn&#8217;t feel it important enough to get working. XCode runs this while I&#8217;m developing anyway. I may come back to it in future once everything else is stable.</p>

<h3>XCode 4.5 Updates</h3>

<p>So, just when I got everything working for XCode 4.4, along comes XCode 4.5. Ever since the 4.2 to 4.3 transition broke code coverage for me, I&#8217;ve been a bit wary of XCode updates. Sure enough after installing 4.5 and trying to build my app, I got an error message saying that the calabash framework was missing a armv7s slice</p>

<pre><code>ld: file is universal (2 slices) but does not contain a(n) armv7s slice: 
...calabash.framework/calabash for architecture armv7s
</code></pre>

<p><a href="http://calaba.sh">Calabash</a> is part of an iOS testing framework based on <a href="http://cukes.info">Cucumber</a>. I&#8217;ve just started to implement this form of testing and it looks really nice. Getting back to the build issue, Ash Furrow has a detailed <a href="http://ashfurrow.com/fix-ios-6-sdk-linker-error">post</a> on this issue. We need to remove armv7s (which refers to the new A6 chip in the iPhone 5) from our valid architectures. Once Calabash gets updated to support this architecture, I can reenable it.</p>

<p>Once everything built in XCode, it was time to try the jenkins build. Naturally this broke also. The problem was that the XCode plugin couldn&#8217;t find the 5.1 simulator.</p>

<pre><code>xcodebuild: error: SDK "/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator5.1.sdk" cannot be located.
</code></pre>

<p>XCode 4.5 had wiped out the simulators for 5.1 so I needed to redownload them. I was able to download these from Preferences->Downloads->Components. XCode also prompted me to download the 6.0 simulator so I got that out of the way while installing 5.1.</p>

<p>Once the simulators were installed I started hitting the same <code>RunPlatformUnitTests</code> error as above. When I opened the script file to reinsert Peter&#8217;s edits I saw that it had changed slightly. Now the error printout was happening in a function on line 80 which overrode <code>RunTestsForApplication()</code>. I deleted that function and I added back in the original patch at line 118 so that now it looks like</p>

<pre><code>if [ "${TEST_HOST}" != "" ]; then
    # All applications are tested the same way, by injecting a bundle.
    # The bundle needs to configure and run the tests itself somehow.
    export CFFIXED_USER_HOME="${BUILT_PRODUCTS_DIR}/UserHome/"
    mkdir -p "${CFFIXED_USER_HOME}"
    mkdir -p "${CFFIXED_USER_HOME}/Library/Caches"
    mkdir "${CFFIXED_USER_HOME}/Library/Preferences"
    mkdir "${CFFIXED_USER_HOME}/Documents"
    export OTHER_TEST_FLAGS="${OTHER_TEST_FLAGS} -RegisterForSystemEvents"

    RunTestsForApplication "${TEST_HOST}" "${TEST_BUNDLE_PATH}"
else
    # If no TEST_HOST is specified, assume we're running the test bundle.

    RunTestsForBundle "${TEST_BUNDLE_PATH}"
fi
</code></pre>

<p>These changes fixed the 4.5 build issues and now I have a working build and test setup again. Finally!!</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Gerard Condon</span></span>

      








  


<time datetime="2012-09-20T01:15:00+01:00" pubdate data-updated="true">Sep 20<span>th</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/development/'>Development</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://www.gerardcondon.com/blog/2012/09/20/further-jenkins-setup-code-signing/" data-via="" data-counturl="http://www.gerardcondon.com/blog/2012/09/20/further-jenkins-setup-code-signing/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2012/09/16/setting-up-jenkins-on-os-x/" title="Previous Post: Setting up Jenkins on OS X">&laquo; Setting up Jenkins on OS X</a>
      
      
        <a class="basic-alignment right" href="/blog/2012/10/22/setting-up-calabash-on-ios/" title="Next Post: Setting up Calabash on iOS">Setting up Calabash on iOS &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/07/10/automating-javascript-jasmine-unit-tests/">Automating Jasmine Unit Tests</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/04/the-design-of-icloud/">The Design of iCloud</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/22/test-driven-design-in-practice/">Test Driven Design in practice</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/05/learning-javascript/">Learning JavaScript</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/04/23/irish-rail-realtime-api/">Irish Rail's RealTime API</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/04/17/uncle-bobs-architecture-talk/">Uncle Bob's "Architecture The Lost Years" Talk</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/03/18/side-project-irish-rail-tracker/">Side Project: Irish Rail Tracker</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/03/17/controllers-in-objective-c/">Controllers in Objective C</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/02/27/destroy-all-software-screencasts/">Destroy All Software Screencasts</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/02/23/year-update-and-reflections/">Year Update and Reflections</a>
      </li>
    
  </ul>
</section>





<section>
  <h1>About Me</h1>
  <p>I'm a software developer based in Cork, Ireland. I use JavaScript, C++ and Java in my day job and have started to create iPhone apps in my spare time.</p>

  <strong>Contact Details:</strong>

  <ul>
    <li><strong>Email:</strong> gercondonblog (at) gmail (dot) com</li>
    <li><strong>Google Plus:</strong> <a href="https://plus.google.com/100711646677802807822?rel=author">Gerard Condon</a></li>
    <li><strong>Twitter:</strong> <a href="https://twitter.com/gercondon">gercondon</a></li>
</ul>
</section>
  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Gerard Condon -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
