
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Adding Code Coverage to Unit Tests for Xcode 4.2 - Gerard Condon's Blog</title>
  <meta name="author" content="Gerard Condon">

  
  <meta name="description" content="If you are going to the effort of having unit tests, then you really need to have code coverage. This will allow you to ensure that your tests are &hellip;">
  <meta name="keywords" content="Xcode, Code Coverage, 4.2, iOS">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.gerardcondon.com/blog/2012/02/17/adding-code-coverage-to-unit-tests/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="feed://feeds.feedburner.com/GerardCondonsBlog" rel="alternate" title="Gerard Condon's Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-29293592-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Gerard Condon's Blog</a></h1>
  
    <h2>Journal of an iPhone developer.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="feed://feeds.feedburner.com/GerardCondonsBlog" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.gerardcondon.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/about">About</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Adding Code Coverage to Unit Tests for Xcode 4.2</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-02-17T22:27:00+00:00" pubdate data-updated="true">Feb 17<span>th</span>, 2012</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>If you are going to the effort of having unit tests, then you really need to have code coverage. This will allow you to ensure that your tests are exercising all your code. It is really easy to spot a missing test when you see a branch of an if-else with no coverage. Code coverage for me is also a way to motivate myself to implement the tests. It&#8217;s like high scores in games - it gives me a target to aim for. Coverage gives feedback that your tests are actually doing something, and with each test you add, you can see the areas of untested code steadily decrease.</p>

<p>To set up code coverage in Xcode 4.2 I used the guide on these blogs - <a href="http://www.infinite-loop.dk/blog/2011/05/covering-it-all-up/">Infinite Loop</a> and <a href="http://mattrajca.com/post/8749868513/llvm-code-coverage-and-xcode-4">Matt Rajca</a>. Originally only the gcc compiler was supported but since then the Clang compiler has had code coverage enabled. This is important as we need to use Clang for ARC and static analysis among other things.</p>

<h3>XCode Build Settings</h3>

<p>Xcode has the concept of build configurations which can have built settings altered independently of each other. The two default configurations are Debug and Release. We want to add a new configuration named Coverage. To do this duplicate the Debug configuration.</p>

<p><img src="/images/codeCoverage/NewBuildConfig.png" title="New Build Configuration" ></p>

<p>In order to specify different settings for configurations in Xcode, hover over the left hand margin directly to the left of the setting we wish to update. An arrow will appear which when clicked will expand to an additional three lines for Debug, Coverage and Release. Editing the top line will alter the setting for all versions. Altering either of the new lines will only update the setting for that version of the build.</p>

<p><img src="/images/codeCoverage/BuildSettings.png" title="Build Settings" ></p>

<ul>
<li>Open the Build Settings tab for the main target. Under &#8220;Apple LLVM 3.0 compiler - Code Generation&#8221;, enable both

<ul>
<li>&#8220;Generate Test Coverage Files&#8221;</li>
<li> &#8220;Instrument Program Flow&#8221;</li>
</ul>
</li>
<li> We now need to add the libprofile_rt library to the build. This will link in the implementations of the coverage functions. If you are seeing link errors like &#8220;_llvm_gcda_increment_indirect_counter&#8221;, referenced from:&#8221;, then you have not done this step.<br/>
This library is located in /Developer/usr/lib. This folder contains libprofile.a which is a static library and a libprofile.dylib which is a dynamic linked library (similar to a .dll in Windows). To link this open the Build Phases tab for the main target. Expand the &#8220;Link Binary with Libraries&#8221; and click the + button. Click &#8220;Add Other&#8221; and then find libprofile_rt.dylib in the file viewer and add it. (Note that this doesn&#8217;t work for me since Xcode 4.3. I&#8217;ve documented the updates I needed to make <a href="http://www.gerardcondon.com/blog/2012/02/21/code-coverage-updates-for-xcode-4-dot-3/">here</a>).</li>
</ul>


<h3>Executing Tests</h3>

<p>Now your unit tests should run and if you examine the build output files under the DerivedData folder you should find .gcda and .gcno coverage files along with your .o files. To find this folder you can go to the Projects tab in the Organizer and select your project. The path to the Derived Data folder is listed here along with an arrow which will open the folder in the Finder.</p>

<p><img src="/images/codeCoverage/DerivedData.png" title="Derived Data" ></p>

<p>From here the path to the coverage files is Build/Intermediates/${Project Target}.build/Coverage-iphonesimulator/${Project Target}.build/Objects-normal/i386. Replace ${Project Target} with the name of your project target.</p>

<h3>Viewing Coverage Data</h3>

<p>To view the coverage data I used <a href="http://code.google.com/p/coverstory/">CoverStory</a>. Simply open the app and point it at the coverage folder. This will give a nice two pane display showing your files on the left and an editor which shows how often each line of code was hit. Now you can identify untested code and add new tests to cover them.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Gerard Condon</span></span>

      








  


<time datetime="2012-02-17T22:27:00+00:00" pubdate data-updated="true">Feb 17<span>th</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/development/'>Development</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://www.gerardcondon.com/blog/2012/02/17/adding-code-coverage-to-unit-tests/" data-via="" data-counturl="http://www.gerardcondon.com/blog/2012/02/17/adding-code-coverage-to-unit-tests/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2012/02/16/moving-the-blog-to-octopress/" title="Previous Post: Moving the blog to Octopress">&laquo; Moving the blog to Octopress</a>
      
      
        <a class="basic-alignment right" href="/blog/2012/02/18/apple-new-introduction-to-ios-development/" title="Next Post: Apple's New Introduction to iOS Development">Apple's New Introduction to iOS Development &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/11/05/managing-sub-modules-with-git-subtree/">Managing Sub-Modules with Git Subtree</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/10/22/setting-up-calabash-on-ios/">Setting up Calabash on iOS</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/09/20/further-jenkins-setup-code-signing/">Further Jenkins Setup for iOS</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/09/16/setting-up-jenkins-on-os-x/">Setting up Jenkins on OS X</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/05/19/localizing-ios-apps/">Localizing iOS Apps</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/05/15/starting-with-core-data/">Starting out with Core Data</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/04/29/joined-the-ios-developer-program/">Joined the iOS Developer program</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/04/02/where-have-all-the-srpgs-gone/">Where have all the SRPGs gone</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/03/20/start-your-own-business-course/">Start your own Business Course</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/03/04/setting-up-octopress-and-github/">Setting up a Blog on Octopress and Github</a>
      </li>
    
  </ul>
</section>





<section>
  <h1>About Me</h1>
  <p>I'm a software developer based in Cork, Ireland. I use C++ and Java in my day job and have started to create iPhone apps in my spare time.</p>
  <p>Contact me at gercondonblog (at) gmail (dot) com</p>
</section>
  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Gerard Condon -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
